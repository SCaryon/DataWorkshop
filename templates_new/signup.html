
{% extends 'layout.html' %}

{% block content %}
<!-- Slider
============================================= -->

<div class="slider-element full-screen " style="background: #FFF url('/static/new/dagoo/images/frontback_alpha.jpg') center center no-repeat; background-size: cover;padding-top:-30px;">
					<div class="vertical-middle container-fluid divcenter clearfix" style="padding: 40px 0px;top:40%;">


						<div class="card divcenter noradius noborder" style="max-width: 400px;">
							<div class="card-body" style="padding: 40px;">
								<div id="signup-form" name="signup-form" class="nobottommargin" action="#" method="post">

							<div style=" font-size: 25px; padding-bottom: 10px; color: #000;" data-langs="signup_txt1">Become a Gooer</div>

									<div class="col_full" style="margin-bottom: 10px;">

										<label for="signup-form-email" data-langs="signup_txt2">Email:</label>
										<input type="text" id="signup-form-email" name="signup-form-email" value="" class="form-control not-dark" />
									</div>

                                    <div class="col_full" style="margin-bottom: 10px;">
										<label for="signup-form-username" data-langs="signup_txt3">Username:</label>
										<input type="text" id="signup-form-username" name="signup-form-username" value="" class="form-control not-dark" />
									</div>

									<div class="col_full" style="margin-bottom: 10px;">
										<label for="signup-form-password" data-langs="signup_txt4">Password:</label>
										<input type="password" id="signup-form-password" name="signup-form-password" value="" class="form-control not-dark" />
									</div>

									<div class="col_full " style="margin-bottom: 10px;">
                                        <label for="signup-form-code" data-langs="signup_txt5" style="width: 100%">Email Verification Code:</label>

										<input style=" width: 62%; display: inline-block;" type="text" id="signup-form-code" name="signup-form-code" value="" class="form-control not-dark" />
                                        <button id="btn_email" onclick="click_email_code();"  style="width:36%; background: #737373;display: inline-block;padding: 0; text-align: center;"  class="button button-3d button-black nomargin" data-langs="signup_txt8">Get Code</button>
									</div>

                                    <div class="form-check" style="text-align: center; margin: 13px 0px;">
                                        <div class="form-check-label" for="gridCheck" data-langs="signup_txt6">By clicking the Register button, you agree to our <a href="{{ url_for('new.term1') }}" target="_blank">Terms of Service</a> and <a href="{{ url_for('new.term2') }}" target="_blank">Privacy Policy</a>.</div>
								    </div>

                                    <div class="col_full " style="text-align: center; margin-top: 32px; margin-bottom: 0px;">
										<button id="btn_register" class="button button-3d button-black nomargin" onclick="click_signup();"  id="signup-form-submit" name="signup-form-submit" value="login"  data-langs="signup_txt7">Register</button>
									</div>
								</div>


							</div>
						</div>

                        <div style="margin:100px;">&nbsp;</div>


					</div>
				</div>
<script>

    $(document).ready(function() {

    });

    $('#signup-form-code').keypress(function(e) {
        if(e.which == 13) {
            click_signup();
        }
    });

    var count;
    var time2;
    function click_email_code(){
        if ($('#signup-form-email').val() == '') {
            alert("Please enter the email");
            return false;
        }

        $('#btn_email').attr('disabled', true);
        $('#btn_email').css("background","#ccc");
        count = 300;
        time2 = setInterval(function () {
            if (count == 0) {
                clearInterval(time2);
                $('#btn_email').removeAttr('disabled');
                $('#btn_email').text("get code");
                count = 300;
            } else {
                $('#btn_email').text(count + " sec");
                count--;
                $('#btn_email').attr('disabled', true);
            }
        }, 1000);
        parameters = {'email': $('#signup-form-email').val()};
        $.ajax({
            type: "POST",
            url: '/login/verify/',
            data: JSON.stringify(parameters),
            contentType: 'application/json; charset=UTF-8',
            dataType: "text",
            success: function (res) {//返回数据根据结果进行相应的处理
                if (res === "fail to send the mail") {
                    alert("fail to send the mail");
                    clearInterval(time2);
                    $('#btn_email').removeAttr('disabled');
                    $('#btn_email').text("get code");
                    $('#btn_email').css('background', "#737373");
                    count = 60;
                }
            },
            error: function () {
                alert("Connect failed");
            }
        });
    }

    function click_signup() {
        if ($('#signup-form-email').val() == "") {
            $('#signup-form-email').focus();
            alert("Email should not be empty!");
            return false;
        } else if ($('#signup-form-username').val() == "") {
            $('#signup-form-username').focus();
            alert("Username should not be empty!");
            return false;
        }else if ($('#signup-form-password').val() == "") {
            $('#signup-form-password').focus();
            alert("Password should not be empty!");
            return false;
        }else if ($('#signup-form-code').val() == "") {
            $('#signup-form-code').focus();
            alert("Email verification code should not be empty!");
            return false;
        }

        var semail = /^(\w|.)+@(\d|.|[a-z]|[A-Z])+$/g;
        if (!semail.test($('#signup-form-email').val()) || $('#signup-form-email').val().length < 5 || $('#signup-form-email').val().length > 50) {
            $('#signup-form-email').focus();
            alert("Please enter a valid email");
            return false;
        }

        var suser = /^\w{4,12}$/g;
        if (!suser.test($('#signup-form-username').val())) {
            $('#signup-form-username').focus();
            alert("Please enter a user name with valid format.");
            return false;
        }

        if ($('#signup-form-password').val().length < 6 || $('#signup-form-password').val().length > 16) {
            $('#signup-form-password').focus();
            alert("The password must between 6-16");
            return false;
        }


        var data = {
            "email": $('#signup-form-email').val(),
            "verify": $('#signup-form-code').val(),
            "username": $('#signup-form-username').val(),
            "password": $('#signup-form-password').val(),
            "tp": "General"
        };

        btn_signup_inactive();

        clearInterval(time2);

        $.ajax({
            type: "POST",
            url: '/login/signup/',
            data: JSON.stringify(data),
            contentType: 'application/json; charset=UTF-8',
            dataType: "html",
            success: function (res) {

                btn_signup_active();
                $('#btn_email').removeAttr('disabled');
                $('#btn_email').text("get code");
                $('#btn_email').css('background', "#737373");

                if (res == "email already exist") {
                    alert("The account exists already, please log in directly");
                    return false;
                }
                else if (res == 'success') {
                    auto_login();
                }
                else if (res == 'Verification code error') {
                    alert(res);
                    return false;
                }
                else if(res=="error"){
                    alert("Something was wrong with the path");
                    return false;
                }
            },
            error: function () {
                alert("Connect failed");
            }
        });
    }

    function auto_login(){

        var data = {
            "email": $('#signup-form-email').val(),
            "password": $('#signup-form-password').val()
        };
        $.ajax({
            type: "POST",
            url: '/login/pass/',
            data: JSON.stringify(data),
            contentType: 'application/json; charset=UTF-8',
            dataType: "html",
            success: function (res) {//返回数据根据结果进行相应的处理
                if (res == "account not exist")
                    alert("Please enter the right username and password");
                else if(res=="password not right")
                    alert("Please enter the right password");
                else {
                    alert("Congratulations! Your Registration is Now Complete!");
                    window.location.href = "{{ url_for('new.home') }}";
                }
            },
            error: function () {
                alert("Connect failed");
            }
        });
    }

    function btn_signup_active(){
        $('#btn_register').removeAttr('disabled');
        $('#btn_register').css("background","#C4A04F");
    }
    function btn_signup_inactive(){
        $('#btn_register').attr('disabled', true);
        $('#btn_register').css("background","#ccc");
    }
    </script>
{% endblock %}